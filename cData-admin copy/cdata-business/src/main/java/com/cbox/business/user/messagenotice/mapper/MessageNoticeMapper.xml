<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cbox.business.user.messagenotice.mapper.MessageNoticeMapper">

	<!-- 查询对象 -->
	<sql id="selectVO">
		<![CDATA[
			select 
				t.rec_id,
				t.notice_title,
				t.notice_type,
				t.notice_headimg,
				t.relation_id,
				t.notice_content,
				t.notice_person,
				t.notice_time,
				t.notice_dept,
				t.notice_status,
				t.notice_handler,
				u.nick_name as user_name
			from d_notice t
			left join sys_user u on t.notice_person=u.user_name
		]]>
	</sql>
	
	<!-- listMessageNotice : 获取消息通知列表数据 -->
	<select id="listMessageNotice" parameterType="java.util.Map" resultType="java.util.HashMap">
		<include refid="selectVO"/>
		where 1=1
		<if test="rec_id != null and rec_id != ''">
			 and t.rec_id=#{rec_id}
		</if>
		<if test="notice_time != null and notice_time != ''">
			 and t.notice_time=#{notice_time}
		</if>
		<if test="notice_person != null and notice_person != ''">
			 and t.notice_person=#{notice_person}
		</if>
		<if test="notice_status != null and notice_status != ''">
			 and t.notice_status=#{notice_status}
		</if>
		<if test="notice_handler   != null and notice_handler   != ''">
			 and t.notice_handler  =#{notice_handler  }
		</if>
		order by t.notice_time desc
	</select>
	

	<!-- getMessageNotice : 获取指定id的消息通知数据 -->
	<select id="getMessageNotice" parameterType="java.util.Map" resultType="java.util.HashMap">
		<include refid="selectVO"/>
		where t.rec_id=#{rec_id}
	</select>

	<select id="listOverdueMessageNotice" parameterType="java.util.Map" resultType="java.util.HashMap">
		<include refid="selectVO"/>
		<![CDATA[
			where DATEDIFF(t.finish_deadline,now())>=0 and t.notice_person=#{notice_person} 
			order by t.notice_time desc
		]]>
	</select>
	
	<delete id="delNotice" parameterType="java.util.Map">
		delete from d_notice where notice_title like #{notice_title} and notice_person=#{notice_person} and relation_id = #{relation_id}
	</delete>

	<update id="allDoneNotice">
		updete d_notice set notice_status='done' where notice_person=#{notice_person}
	</update>

</mapper>